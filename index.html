<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dokuz Taş | AI & Online</title>

<script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#0b1020;color:#e9edff}
.card{background:#121a33;border:1px solid #2a3570;border-radius:16px;padding:14px}
.wrap{max-width:900px;margin:auto;padding:14px}
button{padding:12px 16px;border-radius:14px;border:1px solid #4052b6;background:#0f1630;color:#fff;font-weight:700}
button:hover{border-color:#7aa2ff}
input{width:100%;padding:12px;border-radius:12px;border:1px solid #2a3570;background:#0f1630;color:#fff}
.row{display:flex;gap:10px;flex-wrap:wrap}
.status{margin-top:10px;color:#c9d0ff;white-space:pre-line}
svg{width:100%;max-width:520px}
.pos{fill:#0f1630;stroke:#2a3570;stroke-width:3}
.pos.empty{cursor:pointer}
.stoneW{fill:#f59e0b}
.stoneB{fill:#0b3a8a}
.big{font-size:56px;font-weight:900}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:9999}
</style>
</head>

<body>
<div class="wrap">

<div class="card" id="login">
  <h2>Oyuna Giriş</h2>
  <input id="name" placeholder="Ad Soyad">
  <br><br>
  <input id="classroom" placeholder="Sınıf / Şube">
  <br><br>
  <div class="row">
    <button id="aiBtn">Bilgisayara Karşı</button>
    <button id="onlineBtn">Online Rakip</button>
  </div>

  <div id="onlinePanel" style="display:none;margin-top:10px">
    <button id="createRoom">Oda Oluştur</button>
    <input id="roomCode" placeholder="Oda Kodu">
    <button id="joinRoom">Koda Katıl</button>
  </div>

  <div class="status" id="loginMsg"></div>
</div>

<div class="card" id="game" style="display:none">
  <svg viewBox="0 0 1000 1000">
    <rect x="100" y="100" width="800" height="800" stroke="#93a4ff" fill="none" stroke-width="8"/>
    <g id="board"></g>
  </svg>
  <div class="status" id="status"></div>
</div>

</div>

<div class="overlay" id="end">
  <div class="card" style="text-align:center">
    <div class="big" id="endTitle"></div>
    <p id="endText"></p>
    <button onclick="location.reload()">Tekrar Dene</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyAYzorBVSTCcE3xzDZ9PyPprBdYEzKov3c",
  authDomain:"oyun-3bfba.firebaseapp.com",
  projectId:"oyun-3bfba"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const $=s=>document.querySelector(s);
let MODE="AI",ROLE="W",ROOM=null;
let game={board:Array(24).fill(null),turn:"W"};

const POS=[
[100,100],[500,100],[900,100],
[100,500],[500,500],[900,500],
[100,900],[500,900],[900,900]
];

function render(){
  const g=$("#board"); g.innerHTML="";
  game.board.forEach((v,i)=>{
    const [x,y]=POS[i];
    const c=document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",x);c.setAttribute("cy",y);c.setAttribute("r",40);
    c.classList.add("pos");
    if(!v)c.classList.add("empty");
    if(v==="W")c.classList.add("stoneW");
    if(v==="B")c.classList.add("stoneB");
    c.onclick=()=>move(i);
    g.appendChild(c);
  });
}

function move(i){
  if(game.board[i])return;
  game.board[i]=game.turn;
  game.turn=game.turn==="W"?"B":"W";
  render();
}

function endGame(win){
  $("#end").style.display="flex";
  if(win){
    $("#endTitle").textContent="KAZANDIN!";
    confetti({particleCount:250,spread:100});
  }else{
    $("#endTitle").textContent="KAYBETTİN";
    $("#endText").textContent="Tekrar dene";
  }
}

$("#aiBtn").onclick=()=>{
  MODE="AI";
  $("#login").style.display="none";
  $("#game").style.display="block";
  render();
};

$("#onlineBtn").onclick=()=>{
  $("#onlinePanel").style.display="block";
};

$("#createRoom").onclick=async()=>{
  ROOM=Math.random().toString(36).substring(2,8).toUpperCase();
  await setDoc(doc(db,"rooms",ROOM),{game});
  $("#loginMsg").textContent="Oda Kodu: "+ROOM;
  listen();
};

$("#joinRoom").onclick=async()=>{
  ROOM=$("#roomCode").value.trim();
  const snap=await getDoc(doc(db,"rooms",ROOM));
  if(!snap.exists()){
    $("#loginMsg").textContent="ODA YOK!";
    return;
  }
  game=snap.data().game;
  $("#login").style.display="none";
  $("#game").style.display="block";
  render();
  listen();
};

function listen(){
  onSnapshot(doc(db,"rooms",ROOM),(s)=>{
    if(!s.exists())return;
    game=s.data().game;
    render();
  });
}

</script>
</body>
</html>
